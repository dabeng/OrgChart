{"version":3,"sources":["jquery.orgchart.js"],"names":["factory","module","exports","require","window","document","jQuery","$","undefined","OrgChart","elem","opts","this","$chartContainer","defaultOptions","nodeTitle","nodeId","toggleSiblingsResp","visibleLevel","chartClass","exportButton","exportFilename","exportFileextension","parentNodeSymbol","draggable","direction","pan","zoom","zoominLimit","zoomoutLimit","prototype","init","that","options","extend","$chart","remove","data","class","click","event","target","closest","length","find","removeClass","MutationObserver","triggerInitEvent","type","buildHierarchy","buildJsonDS","children","ajaxURL","attachRel","append","ajax","url","dataType","done","textStatus","jqXHR","fail","errorThrown","console","log","always","attachExportButton","bindPan","bindZoom","mo","mutations","disconnect","initTime","i","j","addedNodes","classList","contains","initCompleted","initEvent","Event","trigger","observe","childList","$exportBtn","text","e","preventDefault","export","setOptions","val","unbindPan","unbindZoom","panStartHandler","delegateTarget","touches","css","lastX","lastY","lastTf","temp","split","indexOf","parseInt","startX","startY","targetTouches","pageX","pageY","on","newX","newY","matrix","join","panEndHandler","chart","off","zoomWheelHandler","oc","newScale","originalEvent","deltaY","setChartScale","zoomStartHandler","dist","getPinchDist","zoomingHandler","zoomEndHandler","diff","Math","sqrt","clientX","clientY","targetScale","abs","parseFloat","$li","subObj","name","contents","eq","trim","relationship","parent","is","siblings","each","key","value","push","flags","forEach","item","loopChart","$tr","id","getHierarchy","valid","getNodeState","$node","relation","$target","isVerticalNode","parents","exist","visible","getRelatedNodes","hideParentEnd","upperLevel","addClass","slice","removeAttr","hideParent","$upperLevel","hideSiblings","$parent","one","showParentEnd","node","isInAction","switchVerticalArrow","showParent","repaint","bind","stopAjax","$nodeLevel","isVisibleNode","index","hideChildrenEnd","animatedNodes","isVerticalDesc","lowerLevel","prevAll","addBack","last","hideChildren","$lowerLevel","$animatedNodes","filter","get","showChildrenEnd","showChildren","$levels","hideSiblingsEnd","$nodeContainer","nodeContainer","lines","$siblings","nextAll","prev","end","switchHorizontalArrow","$lines","showSiblingsEnd","visibleNodes","showRelatedParentEnd","showSiblings","$visibleNodes","startLoading","$edge","not","prop","endLoading","attr","$arrow","toggleClass","$prevSib","$nextSib","next","$sibs","sibsVisible","style","offsetWidth","nodeEnterLeaveHandler","flag","$topEdge","$bottomEdge","$leftEdge","nodeClickHandler","loadNodes","rel","isEmptyObject","addParent","addChildren","addSiblings","HideFirstParentEnd","topEdge","topEdgeClickHandler","stopPropagation","parentState","isFunction","bottomEdgeClickHandler","childrenState","hEdgeClickHandler","$hEdge","siblingsState","families","expandVNodesEnd","vNodes","collapseVNodesEnd","toggleVNodes","$toggleBtn","$descWrapper","$descendants","$children","createGhostNode","ghostNode","nodeCover","$nodeDiv","origEvent","isFirefox","test","navigator","userAgent","toLowerCase","querySelector","createElementNS","add","appendChild","transValues","isHorizontal","scale","setAttribute","outerWidth","outerHeight","xOffset","offsetX","yOffset","offsetY","ghostNodeWrapper","createElement","src","XMLSerializer","serializeToString","dataTransfer","setDragImage","filterAllowedDropNodes","$dragged","$dragZone","$dragHier","dropCriteria","dragstartHandler","setData","dragoverHandler","dropEffect","dragendHandler","dropHandler","$dropZone","dropEvent","draggedNode","dragZone","dropZone","isDefaultPrevented","dropColspan","horizontalEdges","before","$dropSibs","after","dragColspan","$dragSibs","touchstartHandler","touchHandled","touchMoved","innerText","touchmoveHandler","hasClass","simulateMouseEvent","$touchingNode","elementFromPoint","touchingNodeElement","touchTargetNode","touchendHandler","fakeEventForDropHandler","simulatedType","touch","changedTouches","simulatedEvent","createEvent","initMouseEvent","screenX","screenY","dispatchEvent","bindDragDrop","createNode","level","child","parentId","className","nodeTemplate","nodeContent","nodeData","verticalLevel","Number","substr","icon","prepend","$appendTo","parentsUntil","$nodeWrapper","childrenData","hasChildren","Object","keys","$nodesLayer","isHidden","collapsed","isVerticalLayer","$upperLines","lowerLines","$nodeCell","buildChildNode","buildParentNode","$currentRoot","$table","complementLine","$oneSibling","siblingCount","existingSibligCount","buildSiblingNode","$nodeChart","newSiblingCount","isArray","insertPostion","floor","$siblingTds","unwrap","removeNodes","$mask","sourceChart","html2canvas","width","clientHeight","clientWidth","height","onclone","cloneDoc","onrendered","canvas","doc","docWidth","docHeight","jsPDF","addImage","toDataURL","save","isWebkit","documentElement","isFf","sidebar","isEdge","appName","appVersion","msSaveBlob","msToBlob","selector","then","fn","orgchart"],"mappings":"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","file":"jquery.orgchart.min.js","sourcesContent":["/*\r\n * jQuery OrgChart Plugin\r\n * https://github.com/dabeng/OrgChart\r\n *\r\n * Copyright 2016, dabeng\r\n * https://github.com/dabeng\r\n *\r\n * Licensed under the MIT license:\r\n * http://www.opensource.org/licenses/MIT\r\n */\r\n'use strict';\r\n\r\n(function (factory) {\r\n  if (typeof module === 'object' && typeof module.exports === 'object') {\r\n    factory(require('jquery'), window, document);\r\n  } else {\r\n    factory(jQuery, window, document);\r\n  }\r\n}(function ($, window, document, undefined) {\r\n  var OrgChart = function (elem, opts) {\r\n    this.$chartContainer = $(elem);\r\n    this.opts = opts;\r\n    this.defaultOptions = {\r\n      'nodeTitle': 'name',\r\n      'nodeId': 'id',\r\n      'toggleSiblingsResp': false,\r\n      'visibleLevel': 999,\r\n      'chartClass': '',\r\n      'exportButton': false,\r\n      'exportFilename': 'OrgChart',\r\n      'exportFileextension': 'png',\r\n      'parentNodeSymbol': 'fa-users',\r\n      'draggable': false,\r\n      'direction': 't2b',\r\n      'pan': false,\r\n      'zoom': false,\r\n      'zoominLimit': 7,\r\n      'zoomoutLimit': 0.5\r\n    };\r\n  };\r\n  //\r\n  OrgChart.prototype = {\r\n    //\r\n    init: function (opts) {\r\n      var that = this;\r\n      this.options = $.extend({}, this.defaultOptions, this.opts, opts);\r\n      // build the org-chart\r\n      var $chartContainer = this.$chartContainer;\r\n      if (this.$chart) {\r\n        this.$chart.remove();\r\n      }\r\n      var data = this.options.data;\r\n      var $chart = this.$chart = $('<div>', {\r\n        'data': { 'options': this.options },\r\n        'class': 'orgchart' + (this.options.chartClass !== '' ? ' ' + this.options.chartClass : '') + (this.options.direction !== 't2b' ? ' ' + this.options.direction : ''),\r\n        'click': function(event) {\r\n          if (!$(event.target).closest('.node').length) {\r\n            $chart.find('.node.focused').removeClass('focused');\r\n          }\r\n        }\r\n      });\r\n      if (typeof MutationObserver !== 'undefined') {\r\n        this.triggerInitEvent();\r\n      }\r\n      if ($.type(data) === 'object') {\r\n        if (data instanceof $) { // ul datasource\r\n          this.buildHierarchy($chart, this.buildJsonDS(data.children()), 0, this.options);\r\n        } else { // local json datasource\r\n          this.buildHierarchy($chart, this.options.ajaxURL ? data : this.attachRel(data, '00'));\r\n        }\r\n      } else {\r\n        $chart.append('<i class=\"fa fa-circle-o-notch fa-spin spinner\"></i>');\r\n        $.ajax({\r\n          'url': data,\r\n          'dataType': 'json'\r\n        })\r\n        .done(function(data, textStatus, jqXHR) {\r\n          that.buildHierarchy($chart, that.options.ajaxURL ? data : that.attachRel(data, '00'), 0, that.options);\r\n        })\r\n        .fail(function(jqXHR, textStatus, errorThrown) {\r\n          console.log(errorThrown);\r\n        })\r\n        .always(function() {\r\n          $chart.children('.spinner').remove();\r\n        });\r\n      }\r\n      $chartContainer.append($chart);\r\n\r\n      // append the export button\r\n      if (this.options.exportButton && !$chartContainer.find('.oc-export-btn').length) {\r\n        this.attachExportButton();\r\n      }\r\n\r\n      if (this.options.pan) {\r\n        this.bindPan();\r\n      }\r\n\r\n      if (this.options.zoom) {\r\n        this.bindZoom();\r\n      }\r\n\r\n      return this;\r\n    },\r\n    //\r\n    triggerInitEvent: function () {\r\n      var that = this;\r\n      var mo = new MutationObserver(function (mutations) {\r\n        mo.disconnect();\r\n        initTime:\r\n        for (var i = 0; i < mutations.length; i++) {\r\n          for (var j = 0; j < mutations[i].addedNodes.length; j++) {\r\n            if (mutations[i].addedNodes[j].classList.contains('orgchart')) {\r\n              if (that.options.initCompleted && typeof that.options.initCompleted === 'function') {\r\n                that.options.initCompleted(that.$chart);\r\n                var initEvent = $.Event('init.orgchart');\r\n                that.$chart.trigger(initEvent);\r\n                break initTime;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      });\r\n      mo.observe(this.$chartContainer[0], { childList: true });\r\n    },\r\n    //\r\n    attachExportButton: function () {\r\n      var that = this;\r\n      var $exportBtn = $('<button>', {\r\n        'class': 'oc-export-btn' + (this.options.chartClass !== '' ? ' ' + this.options.chartClass : ''),\r\n        'text': 'Export',\r\n        'click': function(e) {\r\n          e.preventDefault();\r\n          that.export();\r\n        }\r\n      });\r\n      this.$chartContainer.append($exportBtn);\r\n    },\r\n    setOptions: function (opts, val) {\r\n      if (typeof opts === 'string') {\r\n        if (opts === 'pan') {\r\n          if (val) {\r\n            this.bindPan();\r\n          } else {\r\n            this.unbindPan();\r\n          }\r\n        }\r\n        if (opts === 'zoom') {\r\n          if (val) {\r\n            this.bindZoom();\r\n          } else {\r\n            this.unbindZoom();\r\n          }\r\n        }\r\n      }\r\n      if (typeof opts === 'object') {\r\n        if (opts.data) {\r\n          this.init(opts);\r\n        } else {\r\n          if (typeof opts.pan !== 'undefined') {\r\n            if (opts.pan) {\r\n              this.bindPan();\r\n            } else {\r\n              this.unbindPan();\r\n            }\r\n          }\r\n          if (typeof opts.zoom !== 'undefined') {\r\n            if (opts.zoom) {\r\n              this.bindZoom();\r\n            } else {\r\n              this.unbindZoom();\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      return this;\r\n    },\r\n    //\r\n    panStartHandler: function (e) {\r\n      var $chart = $(e.delegateTarget);\r\n      if ($(e.target).closest('.node').length || (e.touches && e.touches.length > 1)) {\r\n        $chart.data('panning', false);\r\n        return;\r\n      } else {\r\n        $chart.css('cursor', 'move').data('panning', true);\r\n      }\r\n      var lastX = 0;\r\n      var lastY = 0;\r\n      var lastTf = $chart.css('transform');\r\n      if (lastTf !== 'none') {\r\n        var temp = lastTf.split(',');\r\n        if (lastTf.indexOf('3d') === -1) {\r\n          lastX = parseInt(temp[4]);\r\n          lastY = parseInt(temp[5]);\r\n        } else {\r\n          lastX = parseInt(temp[12]);\r\n          lastY = parseInt(temp[13]);\r\n        }\r\n      }\r\n      var startX = 0;\r\n      var startY = 0;\r\n      if (!e.targetTouches) { // pand on desktop\r\n        startX = e.pageX - lastX;\r\n        startY = e.pageY - lastY;\r\n      } else if (e.targetTouches.length === 1) { // pan on mobile device\r\n        startX = e.targetTouches[0].pageX - lastX;\r\n        startY = e.targetTouches[0].pageY - lastY;\r\n      } else if (e.targetTouches.length > 1) {\r\n        return;\r\n      }\r\n      $chart.on('mousemove touchmove',function(e) {\r\n        if (!$chart.data('panning')) {\r\n          return;\r\n        }\r\n        var newX = 0;\r\n        var newY = 0;\r\n        if (!e.targetTouches) { // pand on desktop\r\n          newX = e.pageX - startX;\r\n          newY = e.pageY - startY;\r\n        } else if (e.targetTouches.length === 1) { // pan on mobile device\r\n          newX = e.targetTouches[0].pageX - startX;\r\n          newY = e.targetTouches[0].pageY - startY;\r\n        } else if (e.targetTouches.length > 1) {\r\n          return;\r\n        }\r\n        var lastTf = $chart.css('transform');\r\n        if (lastTf === 'none') {\r\n          if (lastTf.indexOf('3d') === -1) {\r\n            $chart.css('transform', 'matrix(1, 0, 0, 1, ' + newX + ', ' + newY + ')');\r\n          } else {\r\n            $chart.css('transform', 'matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, ' + newX + ', ' + newY + ', 0, 1)');\r\n          }\r\n        } else {\r\n          var matrix = lastTf.split(',');\r\n          if (lastTf.indexOf('3d') === -1) {\r\n            matrix[4] = ' ' + newX;\r\n            matrix[5] = ' ' + newY + ')';\r\n          } else {\r\n            matrix[12] = ' ' + newX;\r\n            matrix[13] = ' ' + newY;\r\n          }\r\n          $chart.css('transform', matrix.join(','));\r\n        }\r\n      });\r\n    },\r\n    //\r\n    panEndHandler: function (e) {\r\n      if (e.data.chart.data('panning')) {\r\n        e.data.chart.data('panning', false).css('cursor', 'default').off('mousemove');\r\n      }\r\n    },\r\n    //\r\n    bindPan: function () {\r\n      this.$chartContainer.css('overflow', 'hidden');\r\n      this.$chart.on('mousedown touchstart', this.panStartHandler);\r\n      $(document).on('mouseup touchend', { 'chart': this.$chart }, this.panEndHandler);\r\n    },\r\n    //\r\n    unbindPan: function () {\r\n      this.$chartContainer.css('overflow', 'auto');\r\n      this.$chart.off('mousedown touchstart', this.panStartHandler);\r\n      $(document).off('mouseup touchend', this.panEndHandler);\r\n    },\r\n    //\r\n    zoomWheelHandler: function (e) {\r\n      var oc = e.data.oc;\r\n      e.preventDefault();\r\n      var newScale  = 1 + (e.originalEvent.deltaY > 0 ? -0.2 : 0.2);\r\n      oc.setChartScale(oc.$chart, newScale);\r\n    },\r\n    //\r\n    zoomStartHandler: function (e) {\r\n      if(e.touches && e.touches.length === 2) {\r\n        var oc = e.data.oc;\r\n        oc.$chart.data('pinching', true);\r\n        var dist = oc.getPinchDist(e);\r\n        oc.$chart.data('pinchDistStart', dist);\r\n      }\r\n    },\r\n    zoomingHandler: function (e) {\r\n      var oc = e.data.oc;\r\n      if(oc.$chart.data('pinching')) {\r\n        var dist = oc.getPinchDist(e);\r\n        oc.$chart.data('pinchDistEnd', dist);\r\n      }\r\n    },\r\n    zoomEndHandler: function (e) {\r\n      var oc = e.data.oc;\r\n      if(oc.$chart.data('pinching')) {\r\n        oc.$chart.data('pinching', false);\r\n        var diff = oc.$chart.data('pinchDistEnd') - oc.$chart.data('pinchDistStart');\r\n        if (diff > 0) {\r\n          oc.setChartScale(oc.$chart, 1.2);\r\n        } else if (diff < 0) {\r\n          oc.setChartScale(oc.$chart, 0.8);\r\n        }\r\n      }\r\n    },\r\n    //\r\n    bindZoom: function () {\r\n      this.$chartContainer.on('wheel', { 'oc': this }, this.zoomWheelHandler);\r\n      this.$chartContainer.on('touchstart', { 'oc': this }, this.zoomStartHandler);\r\n      $(document).on('touchmove', { 'oc': this }, this.zoomingHandler);\r\n      $(document).on('touchend', { 'oc': this }, this.zoomEndHandler);\r\n    },\r\n    unbindZoom: function () {\r\n      this.$chartContainer.off('wheel', this.zoomWheelHandler);\r\n      this.$chartContainer.off('touchstart', this.zoomStartHandler);\r\n      $(document).off('touchmove', this.zoomingHandler);\r\n      $(document).off('touchend', this.zoomEndHandler);\r\n    },\r\n    //\r\n    getPinchDist: function (e) {\r\n      return Math.sqrt((e.touches[0].clientX - e.touches[1].clientX) * (e.touches[0].clientX - e.touches[1].clientX) +\r\n      (e.touches[0].clientY - e.touches[1].clientY) * (e.touches[0].clientY - e.touches[1].clientY));\r\n    },\r\n    //\r\n    setChartScale: function ($chart, newScale) {\r\n      var opts = $chart.data('options');\r\n      var lastTf = $chart.css('transform');\r\n      var matrix = '';\r\n      var targetScale = 1;\r\n      if (lastTf === 'none') {\r\n        $chart.css('transform', 'scale(' + newScale + ',' + newScale + ')');\r\n      } else {\r\n        matrix = lastTf.split(',');\r\n        if (lastTf.indexOf('3d') === -1) {\r\n          targetScale = Math.abs(window.parseFloat(matrix[3]) * newScale);\r\n          if (targetScale > opts.zoomoutLimit && targetScale < opts.zoominLimit) {\r\n            $chart.css('transform', lastTf + ' scale(' + newScale + ',' + newScale + ')');\r\n          }\r\n        } else {\r\n          targetScale = Math.abs(window.parseFloat(matrix[1]) * newScale);\r\n          if (targetScale > opts.zoomoutLimit && targetScale < opts.zoominLimit) {\r\n            $chart.css('transform', lastTf + ' scale3d(' + newScale + ',' + newScale + ', 1)');\r\n          }\r\n        }\r\n      }\r\n    },\r\n    //\r\n    buildJsonDS: function ($li) {\r\n      var that = this;\r\n      var subObj = {\r\n        'name': $li.contents().eq(0).text().trim(),\r\n        'relationship': ($li.parent().parent().is('li') ? '1': '0') + ($li.siblings('li').length ? 1: 0) + ($li.children('ul').length ? 1 : 0)\r\n      };\r\n      $.each($li.data(), function(key, value) {\r\n         subObj[key] = value;\r\n      });\r\n      $li.children('ul').children().each(function() {\r\n        if (!subObj.children) { subObj.children = []; }\r\n        subObj.children.push(that.buildJsonDS($(this)));\r\n      });\r\n      return subObj;\r\n    },\r\n    //\r\n    attachRel: function (data, flags) {\r\n      var that = this;\r\n      data.relationship = flags + (data.children && data.children.length > 0 ? 1 : 0);\r\n      if (data.children) {\r\n        data.children.forEach(function(item) {\r\n          that.attachRel(item, '1' + (data.children.length > 1 ? 1 : 0));\r\n        });\r\n      }\r\n      return data;\r\n    },\r\n    //\r\n    loopChart: function ($chart) {\r\n      var that = this;\r\n      var $tr = $chart.find('tr:first');\r\n      var subObj = { 'id': $tr.find('.node')[0].id };\r\n      $tr.siblings(':last').children().each(function() {\r\n        if (!subObj.children) { subObj.children = []; }\r\n        subObj.children.push(that.loopChart($(this)));\r\n      });\r\n      return subObj;\r\n    },\r\n    //\r\n    getHierarchy: function () {\r\n      if (typeof this.$chart === 'undefined') {\r\n        return 'Error: orgchart does not exist'\r\n      } else {\r\n        if (!this.$chart.find('.node').length) {\r\n          return 'Error: nodes do not exist'\r\n        } else {\r\n          var valid = true;\r\n          this.$chart.find('.node').each(function () {\r\n            if (!this.id) {\r\n              valid = false;\r\n              return false;\r\n            }\r\n          });\r\n          if (!valid) {\r\n            return 'Error: All nodes of orghcart to be exported must have data-id attribute!';\r\n          }\r\n        }\r\n      }\r\n      return this.loopChart(this.$chart);\r\n    },\r\n    // detect the exist/display state of related node\r\n    getNodeState: function ($node, relation) {\r\n      var $target = {};\r\n      var isVerticalNode = $node.parent().is('li');\r\n      var relation = relation || 'self';\r\n      if (relation === 'parent') {\r\n        if (isVerticalNode) {\r\n          $target = $node.closest('ul').parents('ul');\r\n          if (!$target.length) {\r\n            $target = $node.closest('.nodes');\r\n            if (!$target.length) {\r\n              $target = $node.closest('.verticalNodes').siblings(':first');\r\n            }\r\n          }\r\n        } else {\r\n          $target = $node.closest('.nodes').siblings(':first');\r\n        }\r\n        if ($target.length) {\r\n          if ($target.is('.hidden') || (!$target.is('.hidden') && $target.closest('.nodes').is('.hidden')) || (!$target.is('.hidden') && $target.closest('.verticalNodes').is('.hidden'))) {\r\n            return { 'exist': true, 'visible': false };\r\n          }\r\n          return { 'exist': true, 'visible': true };\r\n        }\r\n      } else if (relation === 'children') {\r\n        $target = isVerticalNode ? $node.parent().children('ul') : $node.closest('tr').siblings(':last');\r\n        if ($target.length) {\r\n          if (!$target.is('.hidden')) {\r\n            return { 'exist': true, 'visible': true };\r\n          }\r\n          return { 'exist': true, 'visible': false };\r\n        }\r\n      } else if (relation === 'siblings') {\r\n        $target = isVerticalNode ? $node.closest('ul') : $node.closest('table').parent().siblings();\r\n        if ($target.length && (!isVerticalNode || $target.children('li').length > 1)) {\r\n          if (!$target.is('.hidden') && !$target.parent().is('.hidden') && (!isVerticalNode || !$target.closest('.verticalNodes').is('.hidden'))) {\r\n            return { 'exist': true, 'visible': true };\r\n          }\r\n          return { 'exist': true, 'visible': false };\r\n        }\r\n      } else {\r\n        $target = $node;\r\n        if ($target.length) {\r\n          if (!(($target.closest('.nodes').length && $target.closest('.nodes').is('.hidden')) ||\r\n            ($target.closest('table').parent().length && $target.closest('table').parent().is('.hidden')) ||\r\n            ($target.parent().is('li') && ($target.closest('ul').is('.hidden') || $target.closest('.verticalNodes').is('.hidden')))\r\n          )) {\r\n            return { 'exist': true, 'visible': true };\r\n          }\r\n          return { 'exist': true, 'visible': false };\r\n        }\r\n      }\r\n      return { 'exist': false, 'visible': false };\r\n    },\r\n    // find the related nodes\r\n    getRelatedNodes: function ($node, relation) {\r\n      if (!$node || !($node instanceof $) || !$node.is('.node')) {\r\n        return $();\r\n      }\r\n      if (relation === 'parent') {\r\n        return $node.closest('.nodes').parent().children(':first').find('.node');\r\n      } else if (relation === 'children') {\r\n        return $node.closest('tr').siblings('.nodes').children().find('.node:first');\r\n      } else if (relation === 'siblings') {\r\n        return $node.closest('table').parent().siblings().find('.node:first');\r\n      } else {\r\n        return $();\r\n      }\r\n    },\r\n    hideParentEnd: function (event) {\r\n      $(event.target).removeClass('sliding');\r\n      event.data.upperLevel.addClass('hidden').slice(1).removeAttr('style');\r\n    },\r\n    // recursively hide the ancestor node and sibling nodes of the specified node\r\n    hideParent: function ($node) {\r\n      var $upperLevel = $node.closest('.nodes').siblings();\r\n      if ($upperLevel.eq(0).find('.spinner').length) {\r\n        $node.closest('.orgchart').data('inAjax', false);\r\n      }\r\n      // hide the sibling nodes\r\n      if (this.getNodeState($node, 'siblings').visible) {\r\n        this.hideSiblings($node);\r\n      }\r\n      // hide the lines\r\n      var $lines = $upperLevel.slice(1);\r\n      $lines.css('visibility', 'hidden');\r\n      // hide the superior nodes with transition\r\n      var $parent = $upperLevel.eq(0).find('.node');\r\n      if (this.getNodeState($parent).visible) {\r\n        $parent.addClass('sliding slide-down').one('transitionend', { 'upperLevel': $upperLevel }, this.hideParentEnd);\r\n      }\r\n      // if the current node has the parent node, hide it recursively\r\n      if (this.getNodeState($parent, 'parent').visible) {\r\n        this.hideParent($parent);\r\n      }\r\n    },\r\n    showParentEnd: function (event) {\r\n      var $node = event.data.node;\r\n      $(event.target).removeClass('sliding');\r\n      if (this.isInAction($node)) {\r\n        this.switchVerticalArrow($node.children('.topEdge'));\r\n      }\r\n    },\r\n    // show the parent node of the specified node\r\n    showParent: function ($node) {\r\n      // just show only one superior level\r\n      var $upperLevel = $node.closest('.nodes').siblings().removeClass('hidden');\r\n      // just show only one line\r\n      $upperLevel.eq(2).children().slice(1, -1).addClass('hidden');\r\n      // show parent node with animation\r\n      var $parent = $upperLevel.eq(0).find('.node');\r\n      this.repaint($parent[0]);\r\n      $parent.addClass('sliding').removeClass('slide-down').one('transitionend', { 'node': $node }, this.showParentEnd.bind(this));\r\n    },\r\n    stopAjax: function ($nodeLevel) {\r\n      if ($nodeLevel.find('.spinner').length) {\r\n        $nodeLevel.closest('.orgchart').data('inAjax', false);\r\n      }\r\n    },\r\n    isVisibleNode: function (index, elem) {\r\n      return this.getNodeState($(elem)).visible;\r\n    },\r\n    //\r\n    hideChildrenEnd: function (event) {\r\n      var $node = event.data.node;\r\n      event.data.animatedNodes.removeClass('sliding');\r\n      if (event.data.isVerticalDesc) {\r\n        event.data.lowerLevel.addClass('hidden');\r\n      } else {\r\n        event.data.animatedNodes.closest('.nodes').prevAll('.lines').removeAttr('style').addBack().addClass('hidden');\r\n        event.data.lowerLevel.last().find('.verticalNodes').addClass('hidden');\r\n      }\r\n      if (this.isInAction($node)) {\r\n        this.switchVerticalArrow($node.children('.bottomEdge'));\r\n      }\r\n    },\r\n    // recursively hide the descendant nodes of the specified node\r\n    hideChildren: function ($node) {\r\n      var $lowerLevel = $node.closest('tr').siblings();\r\n      this.stopAjax($lowerLevel.last());\r\n      var $animatedNodes = $lowerLevel.last().find('.node').filter(this.isVisibleNode.bind(this));\r\n      var isVerticalDesc = $lowerLevel.last().is('.verticalNodes') ? true : false;\r\n      if (!isVerticalDesc) {\r\n        $animatedNodes.closest('table').closest('tr').prevAll('.lines').css('visibility', 'hidden');\r\n      }\r\n      this.repaint($animatedNodes.get(0));\r\n      $animatedNodes.addClass('sliding slide-up').eq(0).one('transitionend', { 'animatedNodes': $animatedNodes, 'lowerLevel': $lowerLevel, 'isVerticalDesc': isVerticalDesc, 'node': $node }, this.hideChildrenEnd.bind(this));\r\n    },\r\n    //\r\n    showChildrenEnd: function (event) {\r\n      var $node = event.data.node;\r\n      event.data.animatedNodes.removeClass('sliding');\r\n      if (this.isInAction($node)) {\r\n        this.switchVerticalArrow($node.children('.bottomEdge'));\r\n      }\r\n    },\r\n    // show the children nodes of the specified node\r\n    showChildren: function ($node) {\r\n      var that = this;\r\n      var $levels = $node.closest('tr').siblings();\r\n      var isVerticalDesc = $levels.is('.verticalNodes') ? true : false;\r\n      var $animatedNodes = isVerticalDesc\r\n        ? $levels.removeClass('hidden').find('.node').filter(this.isVisibleNode.bind(this))\r\n        : $levels.removeClass('hidden').eq(2).children().find('.node:first').filter(this.isVisibleNode.bind(this));\r\n      // the two following statements are used to enforce browser to repaint\r\n      this.repaint($animatedNodes.get(0));\r\n      $animatedNodes.addClass('sliding').removeClass('slide-up').eq(0).one('transitionend', { 'node': $node, 'animatedNodes': $animatedNodes }, this.showChildrenEnd.bind(this));\r\n    },\r\n    //\r\n    hideSiblingsEnd: function (event) {\r\n      var $node = event.data.node;\r\n      var $nodeContainer = event.data.nodeContainer;\r\n      var direction = event.data.direction;\r\n      event.data.lines.removeAttr('style');\r\n      var $siblings = direction ? (direction === 'left' ? $nodeContainer.prevAll(':not(.hidden)') : $nodeContainer.nextAll(':not(.hidden)')) : $nodeContainer.siblings();\r\n      $nodeContainer.closest('.nodes').prev().children(':not(.hidden)')\r\n        .slice(1, direction ? $siblings.length * 2 + 1 : -1).addClass('hidden');\r\n      event.data.animatedNodes.removeClass('sliding');\r\n      $siblings.find('.node:gt(0)').filter(this.isVisibleNode.bind(this))\r\n        .removeClass('slide-left slide-right').addClass('slide-up');\r\n      $siblings.find('.lines, .nodes, .verticalNodes').addClass('hidden')\r\n        .end().addClass('hidden');\r\n\r\n      if (this.isInAction($node)) {\r\n        this.switchHorizontalArrow($node);\r\n      }\r\n    },\r\n    // hide the sibling nodes of the specified node\r\n    hideSiblings: function ($node, direction) {\r\n      var that = this;\r\n      var $nodeContainer = $node.closest('table').parent();\r\n      if ($nodeContainer.siblings().find('.spinner').length) {\r\n        $node.closest('.orgchart').data('inAjax', false);\r\n      }\r\n      if (direction) {\r\n        if (direction === 'left') {\r\n          $nodeContainer.prevAll().find('.node').filter(this.isVisibleNode.bind(this)).addClass('sliding slide-right');\r\n        } else {\r\n          $nodeContainer.nextAll().find('.node').filter(this.isVisibleNode.bind(this)).addClass('sliding slide-left');\r\n        }\r\n      } else {\r\n        $nodeContainer.prevAll().find('.node').filter(this.isVisibleNode.bind(this)).addClass('sliding slide-right');\r\n        $nodeContainer.nextAll().find('.node').filter(this.isVisibleNode.bind(this)).addClass('sliding slide-left');\r\n      }\r\n      var $animatedNodes = $nodeContainer.siblings().find('.sliding');\r\n      var $lines = $animatedNodes.closest('.nodes').prevAll('.lines').css('visibility', 'hidden');\r\n      $animatedNodes.eq(0).one('transitionend', { 'node': $node, 'nodeContainer': $nodeContainer, 'direction': direction, 'animatedNodes': $animatedNodes, 'lines': $lines }, this.hideSiblingsEnd.bind(this));\r\n    },\r\n    //\r\n    showSiblingsEnd: function (event) {\r\n      var $node = event.data.node;\r\n      event.data.visibleNodes.removeClass('sliding');\r\n      if (this.isInAction($node)) {\r\n        this.switchHorizontalArrow($node);\r\n        $node.children('.topEdge').removeClass('fa-chevron-up').addClass('fa-chevron-down');\r\n      }\r\n    },\r\n    //\r\n    showRelatedParentEnd: function(event) {\r\n      $(event.target).removeClass('sliding');\r\n    },\r\n    // show the sibling nodes of the specified node\r\n    showSiblings: function ($node, direction) {\r\n      var that = this;\r\n      // firstly, show the sibling td tags\r\n      var $siblings = $();\r\n      if (direction) {\r\n        if (direction === 'left') {\r\n          $siblings = $node.closest('table').parent().prevAll().removeClass('hidden');\r\n        } else {\r\n          $siblings = $node.closest('table').parent().nextAll().removeClass('hidden');\r\n        }\r\n      } else {\r\n        $siblings = $node.closest('table').parent().siblings().removeClass('hidden');\r\n      }\r\n      // secondly, show the lines\r\n      var $upperLevel = $node.closest('table').closest('tr').siblings();\r\n      if (direction) {\r\n        $upperLevel.eq(2).children('.hidden').slice(0, $siblings.length * 2).removeClass('hidden');\r\n      } else {\r\n        $upperLevel.eq(2).children('.hidden').removeClass('hidden');\r\n      }\r\n      // thirdly, do some cleaning stuff\r\n      if (!this.getNodeState($node, 'parent').visible) {\r\n        $upperLevel.removeClass('hidden');\r\n        var parent = $upperLevel.find('.node')[0];\r\n        this.repaint(parent);\r\n        $(parent).addClass('sliding').removeClass('slide-down').one('transitionend', this.showRelatedParentEnd);\r\n      }\r\n      // lastly, show the sibling nodes with animation\r\n      var $visibleNodes = $siblings.find('.node').filter(this.isVisibleNode.bind(this));\r\n      this.repaint($visibleNodes.get(0));\r\n      $visibleNodes.addClass('sliding').removeClass('slide-left slide-right');\r\n      $visibleNodes.eq(0).one('transitionend', { 'node': $node, 'visibleNodes': $visibleNodes }, this.showSiblingsEnd.bind(this));\r\n    },\r\n    // start up loading status for requesting new nodes\r\n    startLoading: function ($edge) {\r\n      var $chart = this.$chart;\r\n      if (typeof $chart.data('inAjax') !== 'undefined' && $chart.data('inAjax') === true) {\r\n        return false;\r\n      }\r\n\r\n      $edge.addClass('hidden');\r\n      $edge.parent().append('<i class=\"fa fa-circle-o-notch fa-spin spinner\"></i>')\r\n        .children().not('.spinner').css('opacity', 0.2);\r\n      $chart.data('inAjax', true);\r\n      $('.oc-export-btn' + (this.options.chartClass !== '' ? '.' + this.options.chartClass : '')).prop('disabled', true);\r\n      return true;\r\n    },\r\n    // terminate loading status for requesting new nodes\r\n    endLoading: function ($edge) {\r\n      var $node = $edge.parent();\r\n      $edge.removeClass('hidden');\r\n      $node.find('.spinner').remove();\r\n      $node.children().removeAttr('style');\r\n      this.$chart.data('inAjax', false);\r\n      $('.oc-export-btn' + (this.options.chartClass !== '' ? '.' + this.options.chartClass : '')).prop('disabled', false);\r\n    },\r\n    // whether the cursor is hovering over the node\r\n    isInAction: function ($node) {\r\n      return $node.children('.edge').attr('class').indexOf('fa-') > -1 ? true : false;\r\n    },\r\n    //\r\n    switchVerticalArrow: function ($arrow) {\r\n      $arrow.toggleClass('fa-chevron-up').toggleClass('fa-chevron-down');\r\n    },\r\n    //\r\n    switchHorizontalArrow: function ($node) {\r\n      var opts = this.options;\r\n      if (opts.toggleSiblingsResp && (typeof opts.ajaxURL === 'undefined' || $node.closest('.nodes').data('siblingsLoaded'))) {\r\n        var $prevSib = $node.closest('table').parent().prev();\r\n        if ($prevSib.length) {\r\n          if ($prevSib.is('.hidden')) {\r\n            $node.children('.leftEdge').addClass('fa-chevron-left').removeClass('fa-chevron-right');\r\n          } else {\r\n            $node.children('.leftEdge').addClass('fa-chevron-right').removeClass('fa-chevron-left');\r\n          }\r\n        }\r\n        var $nextSib = $node.closest('table').parent().next();\r\n        if ($nextSib.length) {\r\n          if ($nextSib.is('.hidden')) {\r\n            $node.children('.rightEdge').addClass('fa-chevron-right').removeClass('fa-chevron-left');\r\n          } else {\r\n            $node.children('.rightEdge').addClass('fa-chevron-left').removeClass('fa-chevron-right');\r\n          }\r\n        }\r\n      } else {\r\n        var $sibs = $node.closest('table').parent().siblings();\r\n        var sibsVisible = $sibs.length ? !$sibs.is('.hidden') : false;\r\n        $node.children('.leftEdge').toggleClass('fa-chevron-right', sibsVisible).toggleClass('fa-chevron-left', !sibsVisible);\r\n        $node.children('.rightEdge').toggleClass('fa-chevron-left', sibsVisible).toggleClass('fa-chevron-right', !sibsVisible);\r\n      }\r\n    },\r\n    //\r\n    repaint: function (node) {\r\n      if (node) {\r\n        node.style.offsetWidth = node.offsetWidth;\r\n      }\r\n    },\r\n    //\r\n    nodeEnterLeaveHandler: function (event) {\r\n      var $node = $(event.delegateTarget), flag = false;\r\n      var $topEdge = $node.children('.topEdge');\r\n      var $rightEdge = $node.children('.rightEdge');\r\n      var $bottomEdge = $node.children('.bottomEdge');\r\n      var $leftEdge = $node.children('.leftEdge');\r\n      if (event.type === 'mouseenter') {\r\n        if ($topEdge.length) {\r\n          flag = this.getNodeState($node, 'parent').visible;\r\n          $topEdge.toggleClass('fa-chevron-up', !flag).toggleClass('fa-chevron-down', flag);\r\n        }\r\n        if ($bottomEdge.length) {\r\n          flag = this.getNodeState($node, 'children').visible;\r\n          $bottomEdge.toggleClass('fa-chevron-down', !flag).toggleClass('fa-chevron-up', flag);\r\n        }\r\n        if ($leftEdge.length) {\r\n          this.switchHorizontalArrow($node);\r\n        }\r\n      } else {\r\n        $node.children('.edge').removeClass('fa-chevron-up fa-chevron-down fa-chevron-right fa-chevron-left');\r\n      }\r\n    },\r\n    //\r\n    nodeClickHandler: function (event) {\r\n      this.$chart.find('.focused').removeClass('focused');\r\n      $(event.delegateTarget).addClass('focused');\r\n    },\r\n    // load new nodes by ajax\r\n    loadNodes: function (rel, url, $edge) {\r\n      var that = this;\r\n      var opts = this.options;\r\n      $.ajax({ 'url': url, 'dataType': 'json' })\r\n      .done(function (data) {\r\n        if (that.$chart.data('inAjax')) {\r\n          if (rel === 'parent') {\r\n            if (!$.isEmptyObject(data)) {\r\n              that.addParent($edge.parent(), data);\r\n            }\r\n          } else if (rel === 'children') {\r\n            if (data.children.length) {\r\n              that.addChildren($edge.parent(), data[rel]);\r\n            }\r\n          } else {\r\n            that.addSiblings($edge.parent(), data.siblings ? data.siblings : data);\r\n          }\r\n        }\r\n      })\r\n      .fail(function () {\r\n        console.log('Failed to get ' + rel + ' data');\r\n      })\r\n      .always(function () {\r\n        that.endLoading($edge);\r\n      });\r\n    },\r\n    //\r\n    HideFirstParentEnd: function (event) {\r\n      var $topEdge = event.data.topEdge;\r\n      var $node = $topEdge.parent();\r\n      if (this.isInAction($node)) {\r\n        this.switchVerticalArrow($topEdge);\r\n        this.switchHorizontalArrow($node);\r\n      }\r\n    },\r\n    //\r\n    topEdgeClickHandler: function (event) {\r\n      event.stopPropagation();\r\n      var that = this;\r\n      var $topEdge = $(event.target);\r\n      var $node = $(event.delegateTarget);\r\n      var parentState = this.getNodeState($node, 'parent');\r\n      if (parentState.exist) {\r\n        var $parent = $node.closest('table').closest('tr').siblings(':first').find('.node');\r\n        if ($parent.is('.sliding')) { return; }\r\n        // hide the ancestor nodes and sibling nodes of the specified node\r\n        if (parentState.visible) {\r\n          this.hideParent($node);\r\n          $parent.one('transitionend', { 'topEdge': $topEdge }, this.HideFirstParentEnd.bind(this));\r\n        } else { // show the ancestors and siblings\r\n          this.showParent($node);\r\n        }\r\n      } else { // load the new parent node of the specified node by ajax request\r\n        // start up loading status\r\n        if (this.startLoading($topEdge)) {\r\n          var opts = this.options;\r\n          var url = $.isFunction(opts.ajaxURL.parent) ? opts.ajaxURL.parent($node.data('nodeData')) : opts.ajaxURL.parent + $node[0].id;\r\n          this.loadNodes('parent', url, $topEdge);\r\n        }\r\n      }\r\n    },\r\n    //\r\n    bottomEdgeClickHandler: function (event) {\r\n      event.stopPropagation();\r\n      var $bottomEdge = $(event.target);\r\n      var $node = $(event.delegateTarget);\r\n      var childrenState = this.getNodeState($node, 'children');\r\n      if (childrenState.exist) {\r\n        var $children = $node.closest('tr').siblings(':last');\r\n        if ($children.find('.sliding').length) { return; }\r\n        // hide the descendant nodes of the specified node\r\n        if (childrenState.visible) {\r\n          this.hideChildren($node);\r\n        } else { // show the descendants\r\n          this.showChildren($node);\r\n        }\r\n      } else { // load the new children nodes of the specified node by ajax request\r\n        if (this.startLoading($bottomEdge)) {\r\n          var opts = this.options;\r\n          var url = $.isFunction(opts.ajaxURL.children) ? opts.ajaxURL.children($node.data('nodeData')) : opts.ajaxURL.children + $node[0].id;\r\n          this.loadNodes('children', url, $bottomEdge);\r\n        }\r\n      }\r\n    },\r\n    //\r\n    hEdgeClickHandler: function (event) {\r\n      event.stopPropagation();\r\n      var $hEdge = $(event.target);\r\n      var $node = $(event.delegateTarget);\r\n      var opts = this.options;\r\n      var siblingsState = this.getNodeState($node, 'siblings');\r\n      if (siblingsState.exist) {\r\n        var $siblings = $node.closest('table').parent().siblings();\r\n        if ($siblings.find('.sliding').length) { return; }\r\n        if (opts.toggleSiblingsResp) {\r\n          var $prevSib = $node.closest('table').parent().prev();\r\n          var $nextSib = $node.closest('table').parent().next();\r\n          if ($hEdge.is('.leftEdge')) {\r\n            if ($prevSib.is('.hidden')) {\r\n              this.showSiblings($node, 'left');\r\n            } else {\r\n              this.hideSiblings($node, 'left');\r\n            }\r\n          } else {\r\n            if ($nextSib.is('.hidden')) {\r\n              this.showSiblings($node, 'right');\r\n            } else {\r\n              this.hideSiblings($node, 'right');\r\n            }\r\n          }\r\n        } else {\r\n          if (siblingsState.visible) {\r\n            this.hideSiblings($node);\r\n          } else {\r\n            this.showSiblings($node);\r\n          }\r\n        }\r\n      } else {\r\n        // load the new sibling nodes of the specified node by ajax request\r\n        if (this.startLoading($hEdge)) {\r\n          var nodeId = $node[0].id;\r\n          var url = (this.getNodeState($node, 'parent').exist) ?\r\n            ($.isFunction(opts.ajaxURL.siblings) ? opts.ajaxURL.siblings($node.data('nodeData')) : opts.ajaxURL.siblings + nodeId) :\r\n            ($.isFunction(opts.ajaxURL.families) ? opts.ajaxURL.families($node.data('nodeData')) : opts.ajaxURL.families + nodeId);\r\n          this.loadNodes('siblings', url, $hEdge);\r\n        }\r\n      }\r\n    },\r\n    //\r\n    expandVNodesEnd: function (event) {\r\n      event.data.vNodes.removeClass('sliding');\r\n    },\r\n    //\r\n    collapseVNodesEnd: function (event) {\r\n      event.data.vNodes.removeClass('sliding').closest('ul').addClass('hidden');\r\n    },\r\n    // event handler for toggle buttons in Hybrid(horizontal + vertical) OrgChart\r\n    toggleVNodes: function (event) {\r\n      var $toggleBtn = $(event.target);\r\n      var $descWrapper = $toggleBtn.parent().next();\r\n      var $descendants = $descWrapper.find('.node');\r\n      var $children = $descWrapper.children().children('.node');\r\n      if ($children.is('.sliding')) { return; }\r\n      $toggleBtn.toggleClass('fa-plus-square fa-minus-square');\r\n      if ($descendants.eq(0).is('.slide-up')) {\r\n        $descWrapper.removeClass('hidden');\r\n        this.repaint($children.get(0));\r\n        $children.addClass('sliding').removeClass('slide-up').eq(0).one('transitionend', { 'vNodes': $children }, this.expandVNodesEnd);\r\n      } else {\r\n        $descendants.addClass('sliding slide-up').eq(0).one('transitionend', { 'vNodes': $descendants }, this.collapseVNodesEnd);\r\n        $descendants.find('.toggleBtn').removeClass('fa-minus-square').addClass('fa-plus-square');\r\n      }\r\n    },\r\n    //\r\n    createGhostNode: function (event) {\r\n      var $nodeDiv = $(event.target);\r\n      var opts = this.options;\r\n      var origEvent = event.originalEvent;\r\n      var isFirefox = /firefox/.test(window.navigator.userAgent.toLowerCase());\r\n      var ghostNode, nodeCover;\r\n      if (!document.querySelector('.ghost-node')) {\r\n        ghostNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\r\n        ghostNode.classList.add('ghost-node');\r\n        nodeCover = document.createElementNS('http://www.w3.org/2000/svg','rect');\r\n        ghostNode.appendChild(nodeCover);\r\n        $nodeDiv.closest('.orgchart').append(ghostNode);\r\n      } else {\r\n        ghostNode = $nodeDiv.closest('.orgchart').children('.ghost-node').get(0);\r\n        nodeCover = $(ghostNode).children().get(0);\r\n      }\r\n      var transValues = $nodeDiv.closest('.orgchart').css('transform').split(',');\r\n      var isHorizontal = opts.direction === 't2b' || opts.direction === 'b2t';\r\n      var scale = Math.abs(window.parseFloat(isHorizontal ? transValues[0].slice(transValues[0].indexOf('(') + 1) : transValues[1]));\r\n      ghostNode.setAttribute('width', isHorizontal ? $nodeDiv.outerWidth(false) : $nodeDiv.outerHeight(false));\r\n      ghostNode.setAttribute('height', isHorizontal ? $nodeDiv.outerHeight(false) : $nodeDiv.outerWidth(false));\r\n      nodeCover.setAttribute('x',5 * scale);\r\n      nodeCover.setAttribute('y',5 * scale);\r\n      nodeCover.setAttribute('width', 120 * scale);\r\n      nodeCover.setAttribute('height', 40 * scale);\r\n      nodeCover.setAttribute('rx', 4 * scale);\r\n      nodeCover.setAttribute('ry', 4 * scale);\r\n      nodeCover.setAttribute('stroke-width', 1 * scale);\r\n      var xOffset = origEvent.offsetX * scale;\r\n      var yOffset = origEvent.offsetY * scale;\r\n      if (opts.direction === 'l2r') {\r\n        xOffset = origEvent.offsetY * scale;\r\n        yOffset = origEvent.offsetX * scale;\r\n      } else if (opts.direction === 'r2l') {\r\n        xOffset = $nodeDiv.outerWidth(false) - origEvent.offsetY * scale;\r\n        yOffset = origEvent.offsetX * scale;\r\n      } else if (opts.direction === 'b2t') {\r\n        xOffset = $nodeDiv.outerWidth(false) - origEvent.offsetX * scale;\r\n        yOffset = $nodeDiv.outerHeight(false) - origEvent.offsetY * scale;\r\n      }\r\n      if (isFirefox) { // hack for old version of Firefox(< 48.0)\r\n        nodeCover.setAttribute('fill', 'rgb(255, 255, 255)');\r\n        nodeCover.setAttribute('stroke', 'rgb(191, 0, 0)');\r\n        var ghostNodeWrapper = document.createElement('img');\r\n        ghostNodeWrapper.src = 'data:image/svg+xml;utf8,' + (new XMLSerializer()).serializeToString(ghostNode);\r\n        origEvent.dataTransfer.setDragImage(ghostNodeWrapper, xOffset, yOffset);\r\n      } else {\r\n        origEvent.dataTransfer.setDragImage(ghostNode, xOffset, yOffset);\r\n      }\r\n    },\r\n    //\r\n    filterAllowedDropNodes: function ($dragged) {\r\n      var opts = this.options;\r\n      var $dragZone = $dragged.closest('.nodes').siblings().eq(0).find('.node:first');\r\n      var $dragHier = $dragged.closest('table').find('.node');\r\n      this.$chart.data('dragged', $dragged)\r\n        .find('.node').each(function (index, node) {\r\n          if ($dragHier.index(node) === -1) {\r\n            if (opts.dropCriteria) {\r\n              if (opts.dropCriteria($dragged, $dragZone, $(node))) {\r\n                $(node).addClass('allowedDrop');\r\n              }\r\n            } else {\r\n              $(node).addClass('allowedDrop');\r\n            }\r\n          }\r\n        });\r\n    },\r\n    //\r\n    dragstartHandler: function (event) {\r\n      event.originalEvent.dataTransfer.setData('text/html', 'hack for firefox');\r\n      // if users enable zoom or direction options\r\n      if (this.$chart.css('transform') !== 'none') {\r\n        this.createGhostNode(event);\r\n      }\r\n      this.filterAllowedDropNodes($(event.target));\r\n    },\r\n    //\r\n    dragoverHandler: function (event) {\r\n      event.preventDefault();\r\n      if (!$(event.delegateTarget).is('.allowedDrop')) {\r\n        event.originalEvent.dataTransfer.dropEffect = 'none';\r\n      }\r\n    },\r\n    //\r\n    dragendHandler: function (event) {\r\n      this.$chart.find('.allowedDrop').removeClass('allowedDrop');\r\n    },\r\n    //\r\n    dropHandler: function (event) {\r\n      var $dropZone = $(event.delegateTarget);\r\n      var $dragged = this.$chart.data('dragged');\r\n      var $dragZone = $dragged.closest('.nodes').siblings().eq(0).children();\r\n      var dropEvent = $.Event('nodedrop.orgchart');\r\n      this.$chart.trigger(dropEvent, { 'draggedNode': $dragged, 'dragZone': $dragZone.children(), 'dropZone': $dropZone });\r\n      if (dropEvent.isDefaultPrevented()) {\r\n        return;\r\n      }\r\n      // firstly, deal with the hierarchy of drop zone\r\n      if (!$dropZone.closest('tr').siblings().length) { // if the drop zone is a leaf node\r\n        $dropZone.append('<i class=\"edge verticalEdge bottomEdge fa\"></i>')\r\n          .parent().attr('colspan', 2)\r\n          .parent().after('<tr class=\"lines\"><td colspan=\"2\"><div class=\"downLine\"></div></td></tr>'\r\n          + '<tr class=\"lines\"><td class=\"rightLine\"></td><td class=\"leftLine\"></td></tr>'\r\n          + '<tr class=\"nodes\"></tr>')\r\n          .siblings(':last').append($dragged.find('.horizontalEdge').remove().end().closest('table').parent());\r\n      } else {\r\n        var dropColspan = parseInt($dropZone.parent().attr('colspan')) + 2;\r\n        var horizontalEdges = '<i class=\"edge horizontalEdge rightEdge fa\"></i><i class=\"edge horizontalEdge leftEdge fa\"></i>';\r\n        $dropZone.closest('tr').next().addBack().children().attr('colspan', dropColspan);\r\n        if (!$dragged.find('.horizontalEdge').length) {\r\n          $dragged.append(horizontalEdges);\r\n        }\r\n        $dropZone.closest('tr').siblings().eq(1).children(':last').before('<td class=\"leftLine topLine\"></td><td class=\"rightLine topLine\"></td>')\r\n          .end().next().append($dragged.closest('table').parent());\r\n        var $dropSibs = $dragged.closest('table').parent().siblings().find('.node:first');\r\n        if ($dropSibs.length === 1) {\r\n          $dropSibs.append(horizontalEdges);\r\n        }\r\n      }\r\n      // secondly, deal with the hierarchy of dragged node\r\n      var dragColspan = parseInt($dragZone.attr('colspan'));\r\n      if (dragColspan > 2) {\r\n        $dragZone.attr('colspan', dragColspan - 2)\r\n          .parent().next().children().attr('colspan', dragColspan - 2)\r\n          .end().next().children().slice(1, 3).remove();\r\n        var $dragSibs = $dragZone.parent().siblings('.nodes').children().find('.node:first');\r\n        if ($dragSibs.length ===1) {\r\n          $dragSibs.find('.horizontalEdge').remove();\r\n        }\r\n      } else {\r\n        $dragZone.removeAttr('colspan')\r\n          .find('.bottomEdge').remove()\r\n          .end().end().siblings().remove();\r\n      }\r\n    },\r\n    //\r\n    touchstartHandler: function (event) {\r\n        console.log(\"orgChart: touchstart 1: touchHandled=\" + this.touchHandled + \", touchMoved=\" + this.touchMoved + \", target=\" + event.target.innerText);\r\n        if (this.touchHandled)\r\n            return;\r\n        this.touchHandled = true;\r\n        this.touchMoved = false;     // this is so we can work out later if this was a 'press' or a 'drag' touch\r\n        event.preventDefault();\r\n    },\r\n    //\r\n    touchmoveHandler: function (event) {\r\n      if (!this.touchHandled)\r\n        return;\r\n      event.preventDefault();\r\n      if (!this.touchMoved) {\r\n        var nodeIsSelected = $(this).hasClass('focused');\r\n        console.log(\"orgChart: touchmove 1: \" + event.touches.length + \" touches, we have not moved, so simulate a drag start\", event.touches);\r\n        // TODO: visualise the start of the drag (as would happen on desktop)\r\n        this.simulateMouseEvent(event, 'dragstart');\r\n      }\r\n      this.touchMoved = true;\r\n      var $touching = $(document.elementFromPoint(event.touches[0].clientX, event.touches[0].clientY));\r\n      var $touchingNode = $touching.closest('div.node');\r\n \r\n      if ($touchingNode.length > 0) {\r\n        var touchingNodeElement = $touchingNode[0];\r\n        // TODO: simulate the dragover visualisation\r\n        if ($touchingNode.is('.allowedDrop')) {\r\n            console.log(\"orgChart: touchmove 2: this node (\" + touchingNodeElement.id + \") is allowed to be a drop target\");\r\n            this.touchTargetNode = touchingNodeElement;\r\n        } else {\r\n            console.log(\"orgChart: touchmove 3: this node (\" + touchingNodeElement.id + \") is NOT allowed to be a drop target\");\r\n            this.touchTargetNode = null;\r\n        }\r\n      } else {\r\n        console.log(\"orgchart: touchmove 4: not touching a node\");\r\n        this.touchTargetNode = null;\r\n      }\r\n    },\r\n    //\r\n    touchendHandler: function (event) {\r\n      console.log(\"orgChart: touchend 1: touchHandled=\" + this.touchHandled + \", touchMoved=\" + this.touchMoved + \", \" + event.target.innerText + \" \");\r\n      if (!this.touchHandled) {\r\n          console.log(\"orgChart: touchend 2: not handled by us, so aborting\");\r\n          return;\r\n      }\r\n      if (this.touchMoved) {\r\n          // we've had movement, so this was a 'drag' touch\r\n          if (this.touchTargetNode) {\r\n              console.log(\"orgChart: touchend 3: moved to a node, so simulating drop\");\r\n              var fakeEventForDropHandler = { delegateTarget: this.touchTargetNode };\r\n              this.dropHandler(fakeEventForDropHandler);\r\n              this.touchTargetNode = null;\r\n          }\r\n          console.log(\"orgChart: touchend 4: simulating dragend\");\r\n          this.simulateMouseEvent(event, 'dragend');\r\n      }\r\n      else {\r\n          // we did not move, so assume this was a 'press' touch\r\n          console.log(\"orgChart: touchend 5: moved, so simulating click\");\r\n          this.simulateMouseEvent(event, 'click');\r\n      }\r\n      this.touchHandled = false;\r\n    },\r\n    // simulate a mouse event (so we can fake them on a touch device)\r\n    simulateMouseEvent: function (event, simulatedType) {\r\n      // Ignore multi-touch events\r\n      if (event.originalEvent.touches.length > 1) {\r\n        return;\r\n      }\r\n      var touch = event.originalEvent.changedTouches[0];\r\n      var simulatedEvent = document.createEvent('MouseEvents');\r\n      simulatedEvent.initMouseEvent(\r\n        simulatedType,    // type\r\n        true,             // bubbles                    \r\n        true,             // cancelable                 \r\n        window,           // view                       \r\n        1,                // detail                     \r\n        touch.screenX,    // screenX                    \r\n        touch.screenY,    // screenY                    \r\n        touch.clientX,    // clientX                    \r\n        touch.clientY,    // clientY                    \r\n        false,            // ctrlKey                    \r\n        false,            // altKey                     \r\n        false,            // shiftKey                   \r\n        false,            // metaKey                    \r\n        0,                // button                     \r\n        null              // relatedTarget              \r\n      );\r\n      // Dispatch the simulated event to the target element\r\n      event.target.dispatchEvent(simulatedEvent);\r\n    },\r\n    //\r\n    bindDragDrop: function ($node) {\r\n      $node.on('dragstart', this.dragstartHandler.bind(this))\r\n        .on('dragover', this.dragoverHandler.bind(this))\r\n        .on('dragend', this.dragendHandler.bind(this))\r\n        .on('drop', this.dropHandler.bind(this))\r\n        .on('touchstart', this.touchstartHandler.bind(this))\r\n        .on('touchmove', this.touchmoveHandler.bind(this))\r\n        .on('touchend', this.touchendHandler.bind(this));\r\n    },\r\n    // create node\r\n    createNode: function (data) {\r\n      var that = this;\r\n      var opts = this.options;\r\n      var level = data.level;\r\n      if (data.children) {\r\n        $.each(data.children, function (index, child) {\r\n          child.parentId = data.id;\r\n        });\r\n      }\r\n      // construct the content of node\r\n      var $nodeDiv = $('<div' + (opts.draggable ? ' draggable=\"true\"' : '') + (data[opts.nodeId] ? ' id=\"' + data[opts.nodeId] + '\"' : '') + (data.parentId ? ' data-parent=\"' + data.parentId + '\"' : '') + '>')\r\n        .addClass('node ' + (data.className || '') +  (level > opts.visibleLevel ? ' slide-up' : ''));\r\n      if (opts.nodeTemplate) {\r\n        $nodeDiv.append(opts.nodeTemplate(data));\r\n      } else {\r\n        $nodeDiv.append('<div class=\"title\">' + data[opts.nodeTitle] + '</div>')\r\n          .append(typeof opts.nodeContent !== 'undefined' ? '<div class=\"content\">' + (data[opts.nodeContent] || '') + '</div>' : '');\r\n      }\r\n      //\r\n      var nodeData = $.extend({}, data);\r\n      delete nodeData.children;\r\n      $nodeDiv.data('nodeData', nodeData);\r\n      // append 4 direction arrows or expand/collapse buttons\r\n      var flags = data.relationship || '';\r\n      if (opts.verticalLevel && level >= opts.verticalLevel) {\r\n        if ((level + 1) > opts.verticalLevel && Number(flags.substr(2,1))) {\r\n          var icon = level + 1 > opts.visibleLevel ? 'plus' : 'minus';\r\n          $nodeDiv.append('<i class=\"toggleBtn fa fa-' + icon + '-square\"></i>');\r\n        }\r\n      } else {\r\n        if (Number(flags.substr(0,1))) {\r\n          $nodeDiv.append('<i class=\"edge verticalEdge topEdge fa\"></i>');\r\n        }\r\n        if(Number(flags.substr(1,1))) {\r\n          $nodeDiv.append('<i class=\"edge horizontalEdge rightEdge fa\"></i>' +\r\n            '<i class=\"edge horizontalEdge leftEdge fa\"></i>');\r\n        }\r\n        if(Number(flags.substr(2,1))) {\r\n          $nodeDiv.append('<i class=\"edge verticalEdge bottomEdge fa\"></i>')\r\n            .children('.title').prepend('<i class=\"fa '+ opts.parentNodeSymbol + ' symbol\"></i>');\r\n        }\r\n      }\r\n\r\n      $nodeDiv.on('mouseenter mouseleave', this.nodeEnterLeaveHandler.bind(this));\r\n      $nodeDiv.on('click', this.nodeClickHandler.bind(this));\r\n      $nodeDiv.on('click', '.topEdge', this.topEdgeClickHandler.bind(this));\r\n      $nodeDiv.on('click', '.bottomEdge', this.bottomEdgeClickHandler.bind(this));\r\n      $nodeDiv.on('click', '.leftEdge, .rightEdge', this.hEdgeClickHandler.bind(this));\r\n      $nodeDiv.on('click', '.toggleBtn', this.toggleVNodes.bind(this));\r\n\r\n      if (opts.draggable) {\r\n        this.bindDragDrop($nodeDiv);\r\n        this.touchHandled = false;\r\n        this.touchMoved = false;\r\n        this.touchTargetNode = null;\r\n      }\r\n      // allow user to append dom modification after finishing node create of orgchart\r\n      if (opts.createNode) {\r\n        opts.createNode($nodeDiv, data);\r\n      }\r\n\r\n      return $nodeDiv;\r\n    },\r\n    // recursively build the tree\r\n    buildHierarchy: function ($appendTo, data) {\r\n      var that = this;\r\n      var opts = this.options;\r\n      var level = 0;\r\n      if (data.level) {\r\n        level = data.level;\r\n      } else {\r\n        level = data.level = $appendTo.parentsUntil('.orgchart', '.nodes').length + 1;\r\n      }\r\n      // Construct the node\r\n      var childrenData = data.children;\r\n      var hasChildren = childrenData ? childrenData.length : false;\r\n      var $nodeWrapper;\r\n      if (Object.keys(data).length > 2) {\r\n        var $nodeDiv = this.createNode(data);\r\n        if (opts.verticalLevel && level >= opts.verticalLevel) {\r\n          $appendTo.append($nodeDiv);\r\n        }else {\r\n          $nodeWrapper = $('<table>');\r\n          $appendTo.append($nodeWrapper.append($('<tr/>').append($('<td' + (hasChildren ? ' colspan=\"' + childrenData.length * 2 + '\"' : '') + '></td>').append($nodeDiv))));\r\n        }\r\n      }\r\n      // Construct the lower level(two \"connectiong lines\" rows and \"inferior nodes\" row)\r\n      if (hasChildren) {\r\n        var isHidden = (level + 1 > opts.visibleLevel || data.collapsed) ? ' hidden' : '';\r\n        var isVerticalLayer = (opts.verticalLevel && (level + 1) >= opts.verticalLevel) ? true : false;\r\n        var $nodesLayer;\r\n        if (isVerticalLayer) {\r\n          $nodesLayer = $('<ul>');\r\n          if (isHidden && level + 1 > opts.verticalLevel) {\r\n            $nodesLayer.addClass(isHidden);\r\n          }\r\n          if (level + 1 === opts.verticalLevel) {\r\n            $appendTo.children('table').append('<tr class=\"verticalNodes' + isHidden + '\"><td></td></tr>')\r\n              .find('.verticalNodes').children().append($nodesLayer);\r\n          } else {\r\n            $appendTo.append($nodesLayer);\r\n          }\r\n        } else {\r\n          var $upperLines = $('<tr class=\"lines' + isHidden + '\"><td colspan=\"' + childrenData.length * 2 + '\"><div class=\"downLine\"></div></td></tr>');\r\n          var lowerLines = '<tr class=\"lines' + isHidden + '\"><td class=\"rightLine\"></td>';\r\n          for (var i=1; i<childrenData.length; i++) {\r\n            lowerLines += '<td class=\"leftLine topLine\"></td><td class=\"rightLine topLine\"></td>';\r\n          }\r\n          lowerLines += '<td class=\"leftLine\"></td></tr>';\r\n          $nodesLayer = $('<tr class=\"nodes' + isHidden + '\">');\r\n          if (Object.keys(data).length === 2) {\r\n            $appendTo.append($upperLines).append(lowerLines).append($nodesLayer);\r\n          } else {\r\n            $nodeWrapper.append($upperLines).append(lowerLines).append($nodesLayer);\r\n          }\r\n        }\r\n        // recurse through children nodes\r\n        $.each(childrenData, function () {\r\n          var $nodeCell = isVerticalLayer ? $('<li>') : $('<td colspan=\"2\">');\r\n          $nodesLayer.append($nodeCell);\r\n          this.level = level + 1;\r\n          that.buildHierarchy($nodeCell, this);\r\n        });\r\n      }\r\n    },\r\n    // build the child nodes of specific node\r\n    buildChildNode: function ($appendTo, data) {\r\n      $appendTo.find('td:first').attr('colspan', data.length * 2);\r\n      this.buildHierarchy($appendTo, { 'children': data });\r\n    },\r\n    // exposed method\r\n    addChildren: function ($node, data) {\r\n      this.buildChildNode($node.closest('table'), data);\r\n      if (!$node.children('.bottomEdge').length) {\r\n        $node.append('<i class=\"edge verticalEdge bottomEdge fa\"></i>');\r\n      }\r\n      if (!$node.find('.symbol').length) {\r\n        $node.children('.title').prepend('<i class=\"fa '+ this.options.parentNodeSymbol + ' symbol\"></i>');\r\n      }\r\n      if (this.isInAction($node)) {\r\n        this.switchVerticalArrow($node.children('.bottomEdge'));\r\n      }\r\n    },\r\n    // build the parent node of specific node\r\n    buildParentNode: function ($currentRoot, data) {\r\n      data.relationship = data.relationship || '001';\r\n      var $table = $('<table>')\r\n        .append($('<tr>').append($('<td colspan=\"2\">').append(this.createNode(data))))\r\n        .append('<tr class=\"lines\"><td colspan=\"2\"><div class=\"downLine\"></div></td></tr>')\r\n        .append('<tr class=\"lines\"><td class=\"rightLine\"></td><td class=\"leftLine\"></td></tr>');\r\n      this.$chart.prepend($table)\r\n        .children('table:first').append('<tr class=\"nodes\"><td colspan=\"2\"></td></tr>')\r\n        .children('tr:last').children().append(this.$chart.children('table').last());\r\n    },\r\n    // exposed method\r\n    addParent: function ($currentRoot, data) {\r\n      this.buildParentNode($currentRoot, data);\r\n      if (!$currentRoot.children('.topEdge').length) {\r\n        $currentRoot.children('.title').after('<i class=\"edge verticalEdge topEdge fa\"></i>');\r\n      }\r\n      if (this.isInAction($currentRoot)) {\r\n        this.switchVerticalArrow($currentRoot.children('.topEdge'));\r\n      }\r\n    },\r\n    // subsequent processing of build sibling nodes\r\n    complementLine: function ($oneSibling, siblingCount, existingSibligCount) {\r\n      var lines = '';\r\n      for (var i = 0; i < existingSibligCount; i++) {\r\n        lines += '<td class=\"leftLine topLine\"></td><td class=\"rightLine topLine\"></td>';\r\n      }\r\n      $oneSibling.parent().prevAll('tr:gt(0)').children().attr('colspan', siblingCount * 2)\r\n        .end().next().children(':first').after(lines);\r\n    },\r\n    // build the sibling nodes of specific node\r\n    buildSiblingNode: function ($nodeChart, data) {\r\n      var newSiblingCount = $.isArray(data) ? data.length : data.children.length;\r\n      var existingSibligCount = $nodeChart.parent().is('td') ? $nodeChart.closest('tr').children().length : 1;\r\n      var siblingCount = existingSibligCount + newSiblingCount;\r\n      var insertPostion = (siblingCount > 1) ? Math.floor(siblingCount/2 - 1) : 0;\r\n      // just build the sibling nodes for the specific node\r\n      if ($nodeChart.parent().is('td')) {\r\n        var $parent = $nodeChart.closest('tr').prevAll('tr:last');\r\n        $nodeChart.closest('tr').prevAll('tr:lt(2)').remove();\r\n        this.buildChildNode($nodeChart.parent().closest('table'), data);\r\n        var $siblingTds = $nodeChart.parent().closest('table').children('tr:last').children('td');\r\n        if (existingSibligCount > 1) {\r\n          this.complementLine($siblingTds.eq(0).before($nodeChart.closest('td').siblings().addBack().unwrap()), siblingCount, existingSibligCount);\r\n        } else {\r\n          this.complementLine($siblingTds.eq(insertPostion).after($nodeChart.closest('td').unwrap()), siblingCount, 1);\r\n        }\r\n      } else { // build the sibling nodes and parent node for the specific ndoe\r\n        this.buildHierarchy($nodeChart.closest('.orgchart'), data);\r\n        this.complementLine($nodeChart.next().children('tr:last').children().eq(insertPostion).after($('<td colspan=\"2\">').append($nodeChart)),\r\n          siblingCount, 1);\r\n      }\r\n    },\r\n    //\r\n    addSiblings: function ($node, data) {\r\n      this.buildSiblingNode($node.closest('table'), data);\r\n      $node.closest('.nodes').data('siblingsLoaded', true);\r\n      if (!$node.children('.leftEdge').length) {\r\n        $node.children('.topEdge').after('<i class=\"edge horizontalEdge rightEdge fa\"></i><i class=\"edge horizontalEdge leftEdge fa\"></i>');\r\n      }\r\n      if (this.isInAction($node)) {\r\n        this.switchHorizontalArrow($node);\r\n        $node.children('.topEdge').removeClass('fa-chevron-up').addClass('fa-chevron-down');\r\n      }\r\n    },\r\n    //\r\n    removeNodes: function ($node) {\r\n      var $parent = $node.closest('table').parent();\r\n      var $sibs = $parent.parent().siblings();\r\n      if ($parent.is('td')) {\r\n        if (this.getNodeState($node, 'siblings').exist) {\r\n          $sibs.eq(2).children('.topLine:lt(2)').remove();\r\n          $sibs.slice(0, 2).children().attr('colspan', $sibs.eq(2).children().length);\r\n          $parent.remove();\r\n        } else {\r\n          $sibs.eq(0).children().removeAttr('colspan')\r\n            .find('.bottomEdge').remove()\r\n            .end().end().siblings().remove();\r\n        }\r\n      } else {\r\n        $parent.add($parent.siblings()).remove();\r\n      }\r\n    },\r\n    //\r\n    export: function (exportFilename, exportFileextension) {\r\n      var that = this;\r\n      exportFilename = (typeof exportFilename !== 'undefined') ?  exportFilename : this.options.exportFilename;\r\n      exportFileextension = (typeof exportFileextension !== 'undefined') ?  exportFileextension : this.options.exportFileextension;\r\n      if ($(this).children('.spinner').length) {\r\n        return false;\r\n      }\r\n      var $chartContainer = this.$chartContainer;\r\n      var $mask = $chartContainer.find('.mask');\r\n      if (!$mask.length) {\r\n        $chartContainer.append('<div class=\"mask\"><i class=\"fa fa-circle-o-notch fa-spin spinner\"></i></div>');\r\n      } else {\r\n        $mask.removeClass('hidden');\r\n      }\r\n      var sourceChart = $chartContainer.addClass('canvasContainer').find('.orgchart:not(\".hidden\")').get(0);\r\n      var flag = that.options.direction === 'l2r' || that.options.direction === 'r2l';\r\n      html2canvas(sourceChart, {\r\n        'width': flag ? sourceChart.clientHeight : sourceChart.clientWidth,\r\n        'height': flag ? sourceChart.clientWidth : sourceChart.clientHeight,\r\n        'onclone': function (cloneDoc) {\r\n          $(cloneDoc).find('.canvasContainer').css('overflow', 'visible')\r\n            .find('.orgchart:not(\".hidden\"):first').css('transform', '');\r\n        },\r\n        'onrendered': function (canvas) {\r\n          $chartContainer.find('.mask').addClass('hidden');\r\n          if (exportFileextension.toLowerCase() === 'pdf') {\r\n            var doc = {};\r\n            var docWidth = Math.floor(canvas.width * 0.2646);\r\n            var docHeight = Math.floor(canvas.height * 0.2646);\r\n            if (docWidth > docHeight) {\r\n              doc = new jsPDF('l', 'mm', [docWidth, docHeight]);\r\n            } else {\r\n              doc = new jsPDF('p', 'mm', [docHeight, docWidth]);\r\n            }\r\n            doc.addImage(canvas.toDataURL(), 'png', 0, 0);\r\n            doc.save(exportFilename + '.pdf');\r\n          } else {\r\n            var isWebkit = 'WebkitAppearance' in document.documentElement.style;\r\n            var isFf = !!window.sidebar;\r\n            var isEdge = navigator.appName === 'Microsoft Internet Explorer' || (navigator.appName === \"Netscape\" && navigator.appVersion.indexOf('Edge') > -1);\r\n\r\n            if ((!isWebkit && !isFf) || isEdge) {\r\n              window.navigator.msSaveBlob(canvas.msToBlob(), exportFilename + '.png');\r\n            } else {\r\n              var selector = '.oc-download-btn' + (that.options.chartClass !== '' ? '.' + that.options.chartClass : '');\r\n              if (!$chartContainer.find(selector).length) {\r\n                $chartContainer.append('<a class=\"oc-download-btn' + (that.options.chartClass !== '' ? ' ' + that.options.chartClass : '') + '\"'\r\n                  + ' download=\"' + exportFilename + '.png\"></a>');\r\n              }\r\n              $chartContainer.find(selector).attr('href', canvas.toDataURL())[0].click();\r\n            }\r\n          }\r\n        }\r\n      })\r\n      .then(function () {\r\n        $chartContainer.removeClass('canvasContainer');\r\n      }, function () {\r\n        $chartContainer.removeClass('canvasContainer');\r\n      });\r\n    }\r\n  };\r\n\r\n  $.fn.orgchart = function (opts) {\r\n    return new OrgChart(this, opts).init();\r\n  };\r\n\r\n}));\r\n"]}